<!--REWRITE-->

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a [routerLink]="['/dashboard']">
      <div class="logo-container">
        <div class="logo">
          <img src="/assets/img/social-alpha-logo-250.png" alt="Creative Tim Logo" style="height: 60px;width: 60px;">
        </div>
      </div>
    </a>
    <!-- <a class="navbar-brand" href="#">Navbar</a> -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active" *ngIf="auth.currentUserValue.id">
          <a class="nav-link" [routerLink]="['/dashboard']">Dashboard <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [routerLink]="['/problems']">Problems</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [routerLink]="['/abc']">Solutions</a>
        </li>


        <button mat-raised-button class="btn btn-white btn-round btn-just-icon" [routerLink]="'/search'">
          <i class="material-icons">search</i>
          <div class="ripple-container"></div>
        </button>

        <li class="nav-item dropdown" *ngIf="auth.currentUserValue.id">
          <a class="nav-link" href="#pablo" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <i class="material-icons">notifications</i>
            <span class="notification">{{
              objectValues(notifications).length
              }}</span>
            <p>
              <span class="d-lg-none d-md-block">Some Actions</span>
            </p>
          </a>
          <div *ngIf="objectValues(notifications).length" class="dropdown-menu dropdown-menu-right"
            aria-labelledby="navbarDropdownMenuLink">
            <div *ngFor="let notification of objectValues(notifications)">


              <a *ngIf="!notification.enrichment_id && !notification.collaborator && !notification.discussion_id && !notification.validated_by && notification.tag_id && !notification.is_update"
                class="dropdown-item" name="{{ notification.id }}" [routerLink]="
                
                '/problems/' + notification.problem_id
              " (click)="onRead($event)">

                New problem "{{ notification.problemsByproblemId.title }}"
                {{ (notification.is_update && "updated") || "added" }} in sector "{{notification.tag.name}}"


              </a>

              <a *ngIf="!notification.enrichment_id && !notification.collaborator && !notification.discussion_id && !notification.validated_by && !notification.tag_id "
                class="dropdown-item" name="{{ notification.id }}" [routerLink]="
                
                '/problems/' + notification.problem_id
              " (click)="onRead($event)">

                Problem "{{ notification.problemsByproblemId.title }}" is
                {{ (notification.is_update && "updated") || "added" }}


              </a>

              <a *ngIf="notification.enrichment_id" class="dropdown-item" name="{{ notification.id }}"
                (click)="onRead($event)" [routerLink]="
                
                '/problems/' + notification.problem_id
              ">

                Enrichment added for problem "{{ notification.problemsByproblemId.title }}"

              </a>

              <a *ngIf="notification.collaborator" class="dropdown-item" name="{{ notification.id }}"
                (click)="onRead($event)" [routerLink]="
                
                '/problems/' + notification.problem_id
              ">

                New Collaboration on problem "{{ notification.problemsByproblemId.title }}"


              </a>

              <a *ngIf="notification.validated_by" class="dropdown-item" name="{{ notification.id }}"
                (click)="onRead($event)" [routerLink]="
                
                '/problems/' + notification.problem_id
              ">

                Problem "{{ notification.problemsByproblemId.title }}" is validated by an expert

              </a>

              <a *ngIf="notification.discussion_id" class="dropdown-item" name="{{ notification.id }}"
                (click)="onRead($event)" [routerLink]="
                
                '/problems/' + notification.problem_id
              ">

                You were mentioned on discussion "{{ notification.discussion.text}}" on
                problem
                "{{ notification.problemsByproblemId.title }}"

              </a>


              <!-- <a *ngIf="notification.validated_by" class="dropdown-item" name="{{ notification.id }}"
            href="problems/{{ notification.id }}" (click)="onRead($event)">

             {{ notification.problemsByproblemId.title }} is validated by an expert

          </a> -->




            </div>

            <div class="text-center" *ngIf="objectValues(notifications).length > 0; else noNotification">
              <button mat-raised-button class="btn btn-success" (click)="allRead()"
                *ngIf="objectValues(notifications).length > 1">
                Mark all as Read
              </button>
            </div>
            <ng-template #noNotification> No New Notifications</ng-template>
            <!-- <a class="dropdown-item">No New Notifications</a> -->

            <!-- <a class="dropdown-item" href="#">User1 validated your problem</a>
            <a class="dropdown-item" href="#">3 new problems added to water</a>
            <a class="dropdown-item" href="#"
              >User2 proposed a solution to your problem</a
            >
            <a class="dropdown-item" href="#"
              >2 new collaborators for problem 26</a
            > -->
          </div>
        </li>
        <!-- <li class="nav-item">
          <a class="nav-link" href="#pablo">
            <i class="material-icons">person</i>
            <p>
              <span class="d-lg-none d-md-block">Account</span>
            </p>
          </a>
        </li> -->

        <!-- <li class="nav-item" routerLinkActive="active">
            <a class="nav-link" [routerLink]="['/dashboard']">
              <i class="material-icons">dashboard</i> Dashboard
            </a>
          </li> -->

        <li class="nav-item" routerLinkActive="active" *ngIf="!auth.currentUserValue.id">
          <a class="nav-link" [routerLink]="['/auth/register']">
            <i class="material-icons">person_add</i> Register
          </a>
        </li>
        <li class="nav-item" routerLinkActive="active" *ngIf="!auth.currentUserValue.id">
          <a class="nav-link" [routerLink]="['/auth/login']">
            <i class="material-icons">fingerprint</i> Login
          </a>
        </li>


        <!-- <li class="nav-item" routerLinkActive="active">
            <a class="nav-link" [routerLink]="['/pages/lock']">
              <i class="material-icons">lock_open</i> Lock
            </a>
          </li> -->


        <li class="nav-item dropdown" *ngIf="auth.currentUserValue.id">
          <a class="nav-link" href="#pablo" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <div class="photo">
              <img class="img"
                src="{{(usersService.currentUser.photo_url && usersService.currentUser.photo_url.url) ? usersService.currentUser.photo_url.url : './assets/img/default-avatar.png'}}"
                style="border-radius:50%;object-fit: cover;height: 40px;width: 40px;" />
            </div>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
            <div class="row justify-content-center">
              <h6 style="text-transform: capitalize"><b>{{usersService.currentUser.name}}</b></h6>
            </div>
            <div class="row justify-content-center">
              <h6 style="color: #999">{{usersService.currentUser.organization}}</h6>
            </div>
            <hr>
            <a class="dropdown-item" [routerLink]="'/users/'+auth.currentUserValue.id">My Profile</a>
            <a class="dropdown-item" (click)="logout()" style="cursor: pointer;object-fit: cover;"
              *ngIf="auth.currentUserValue">Logout</a>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!--REWRITE-->