<div class="card-collapse">
  <div class="card-header" role="tab" id="headingTwo">
    <h5 class="mb-0">
      <a class="collapsed" data-toggle="collapse" href="#comment-{{comment.id}}" aria-expanded="true"
        attr.aria-controls="comment-{{comment.id}}">
        {{comment.usersBycreatedBy.name || 'Anonymous'}}, {{comment.modified_at | date:short}}
        <i class="material-icons">keyboard_arrow_down</i>
      </a>
    </h5>
  </div>


  <div id="comment-{{comment.id}}" class="collapse show" role="tabpanel" aria-labelledby="headingTwo"
    attr.data-target="#comment-{{comment.id}}">
    <div class="card-body">

      <!-- More button for comment -->
      <ul class="navbar-nav" style="float:right;">
        <li class="nav-item dropdown">
          <a class="nav-link more_icon" href="#pablo" id="discussion_more_btn" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <i class="material-icons">
              more_vert
            </i>
          </a>
          <div class="dropdown-menu" aria-labelledby="discussion_more_btn">
            <a class="dropdown-item" href="javascript:void(0)" (click)="idToDelete(comment)">
              <i class="material-icons" style="color:var(--danger);">
                delete_outline
              </i>
              Delete
            </a>
          </div>
        </li>
      </ul>

      <div innerHTML="{{comment.text}}"></div>
      <!-- Attachments for comments -->
      <p>
        <span *ngFor="let attachment of comment.attachments; let i= index;" class="discussion_thumbnail">
          <ng-container *ngIf="attachment.mimeType">
            <img *ngIf="attachment.mimeType.startsWith('image') && i < attachmentToShow" src="{{attachment['url']}}"
              (click)="assignUrl(comment.attachments, i)" />

            <!-- icon in case url is of video -->
            <img src="../../../assets/img/video_icon.png" alt="video"
              *ngIf="attachment.mimeType && attachment.mimeType.startsWith('video') && i < attachmentToShow"
              (click)="assignUrl(comment.attachments, i)">
            <!-- <p>{{testMimeType(attachment.mimeType)}}</p> -->
            <img src="../../../assets/img/document_icon.png" alt="document" *ngIf="testMimeType(attachment.mimeType) && i <
              attachmentToShow" (click)="assignUrl(comment.attachments, i)">

            <img src="../../../assets/img/pdf_icon.png" alt="document" *ngIf="attachment.mimeType.endsWith('pdf') && i <
              attachmentToShow" (click)="assignUrl(comment.attachments, i)">
          </ng-container>
        </span>

        <!-- show more for comments -->
        <i class="material-icons"
          *ngIf="comment && comment.attachments && comment.attachments.length > 2 && !commentsExpanded"
          style="padding: 5px; line-height: 50px;cursor: pointer;" (click)="displayMoreAttachComments()"
          matTooltip="show more" [matTooltipPosition]="'right'">
          arrow_forward_ios
        </i>
        <!-- show less for comments -->
        <i class="material-icons" *ngIf="commentsExpanded" style="padding:5px; line-height: 50px;cursor: pointer;"
          (click)="displayMoreAttachComments()" matTooltip="show less" [matTooltipPosition]="'right'">
          arrow_back_ios
        </i>
      </p>

      <!-- <button class="btn btn-link btn-sm" matTooltip="upvote"
        [ngStyle]="{'color':enrichmentVoted? '#ff9800' : 'black' }">
        <i class="material-icons">
          thumb_up
        </i>
        <span>&nbsp;&nbsp;{{2}}</span>
      </button> -->
      <i class="material-icons actions" (click)="toggleVoteDiscussions()"
                [ngStyle]="{'color':voters.has(userId) ? '#1E90FF' : 'black' }">
                thumb_up
              </i>
              <span>{{voters.size}}</span>
      <span class="dropdown">
        <button class="btn btn-warning btn-link" type="button" id="discussion_share_btn" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          <i class="material-icons actions">
            share
          </i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="discussion_share_btn">
          <li><a (click)="getCommentIdToShare(comment.id,'linkedin')">LinkedIn</a></li>
          <li><a (click)="getCommentIdToShare(comment.id,'facebook')">Facebook</a></li>
          <li><a (click)="getCommentIdToShare(comment.id,'twitter')">Twitter</a></li>
          <li><a (click)="getCommentIdToShare(comment.id,'email')">Email</a></li>
          <li><a (click)="getCommentIdToShare(comment.id,'sms')">SMS</a></li>
        </ul>
      </span>

      <button mat-raised-button class="btn btn-link btn-warning btn-sm" matTooltip="Click to reply"
        [matTooltipPosition]="'below'" *ngIf="!(showReplyBox && replyingTo === comment.id)"
        (click)="replyTo(comment.id)">Reply</button>
      <app-submit-comment *ngIf="showReplyBox && replyingTo === comment.id" [users]="users" [actionText]="'Reply'"
        [cancelShown]="true" [id]="comment.id" (cancel)="showReplyBox=false" (submit)="onCommentSubmit($event)">
      </app-submit-comment>
      <div class="card-collapse" *ngFor="let reply of sortReplies(replies)">
        <div class="card-header" role="tab" id="headingTwo">
          <h5 class="mb-0">
            <a class="collapsed" data-toggle="collapse" href="#reply-{{reply.id}}" aria-expanded="false"
              attr.aria-controls="reply-{{reply.id}}">
              {{reply.usersBycreatedBy.name || 'Anonymous'}}, {{reply.modified_at | date:short}}
              <i class="material-icons">keyboard_arrow_down</i>
            </a>
          </h5>
        </div>
        <div id="reply-{{reply.id}}" class="collapse" role="tabpanel" aria-labelledby="headingTwo"
          attr.data-target="#reply-{{reply.id}}">
          <div class="card-body">

            <!-- More button for replies -->
            <ul class="navbar-nav" style="float:right;">
              <li class="nav-item dropdown">
                <a class="nav-link more_icon" href="#pablo" id="discussion_more_btn" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">
                    more_vert
                  </i>
                </a>
                <div class="dropdown-menu" aria-labelledby="discussion_more_btn">
                  <a class="dropdown-item" href="javascript:void(0)" (click)="idToDelete(reply)">
                    <i class="material-icons" style="color:var(--danger);">
                      delete_outline
                    </i>
                    Delete
                  </a>
                </div>
              </li>
            </ul>

            <div innerHTML="{{reply.text}}"></div>
            <!-- Attachments for replies -->
            <p>
              <span *ngFor="let attachment of reply.attachments; let i=index;" class="discussion_thumbnail">
                <img *ngIf="attachment.mimeType.startsWith('image') && i < repliesAttachmentNum"
                  (click)="assignUrl(reply.attachments, i)" src="{{attachment['url']}}" />

                <!-- icon in case url is of video -->
                <img src="../../../assets/img/video_icon.png" alt="video"
                  *ngIf="attachment.mimeType.startsWith('video') && i < repliesAttachmentNum"
                  (click)="assignUrl(reply.attachments, i)">

                <img src="../../../assets/img/document_icon.png" alt="document" *ngIf="testMimeType(attachment.mimeType) && i <
                    repliesAttachmentNum" (click)="assignUrl(reply.attachments, i)">

                <img src="../../../assets/img/pdf_icon.png" alt="document" *ngIf="attachment.mimeType.endsWith('pdf') && i <
                    repliesAttachmentNum" (click)="assignUrl(reply.attachments, i)">
              </span>
              <!-- Show more for replies -->
              <i class="material-icons"
                *ngIf="reply && reply.attachments && reply.attachments.length > 2 && !repliesExpanded"
                style="padding: 5px; line-height: 40px;cursor: pointer;"
                (click)="displayMoreAttachReplies(reply.attachments)" matTooltip="show more"
                [matTooltipPosition]="'right'">
                arrow_forward_ios
              </i>

              <!-- Show less for replies -->
              <i class="material-icons" *ngIf="repliesExpanded" style="padding:5px; line-height: 40px;cursor: pointer;"
                (click)="displayMoreAttachReplies(reply.attachments)" matTooltip="show less"
                [matTooltipPosition]="'right'">
                arrow_back_ios
              </i>
            </p>

            <!-- <button mat-raised-button class="btn btn-warning btn-round btn-sm" matTooltip="Click to reply" [matTooltipPosition]="'below'" *ngIf="!(showReplyBox && replyingTo === reply.id)"
        (click)="replyTo(reply.id)">Reply</button>
        <app-submit-comment *ngIf="showReplyBox && replyingTo === reply.id" [users]="objectValues(usersService.allUsers)"
        [actionText]="'Reply'" [cancelShown]="true" (cancel)="showReplyBox=false" (submit)="onCommentSubmit($event)"></app-submit-comment> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>